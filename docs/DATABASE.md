# üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Telegram Ticket Bot.

## üìä ER-–¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     USERS       ‚îÇ    ‚îÇ    TICKETS      ‚îÇ    ‚îÇ   CATEGORIES    ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ id (UUID) PK    ‚îÇ    ‚îÇ id (UUID) PK    ‚îÇ    ‚îÇ id (UUID) PK    ‚îÇ
‚îÇ telegram_id     ‚îÇ<‚îÄ‚îÄ‚îÄ‚î§ user_id FK      ‚îÇ    ‚îÇ name            ‚îÇ
‚îÇ username        ‚îÇ    ‚îÇ assigned_to FK‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§ description     ‚îÇ
‚îÇ first_name      ‚îÇ    ‚îÇ category_id FK‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ>‚îÇ icon            ‚îÇ
‚îÇ last_name       ‚îÇ    ‚îÇ title           ‚îÇ    ‚îÇ color           ‚îÇ
‚îÇ role            ‚îÇ    ‚îÇ description     ‚îÇ    ‚îÇ is_active       ‚îÇ
‚îÇ is_active       ‚îÇ    ‚îÇ status          ‚îÇ    ‚îÇ sort_order      ‚îÇ
‚îÇ avatar_url      ‚îÇ    ‚îÇ priority        ‚îÇ    ‚îÇ created_at      ‚îÇ
‚îÇ created_at      ‚îÇ    ‚îÇ created_at      ‚îÇ    ‚îÇ updated_at      ‚îÇ
‚îÇ updated_at      ‚îÇ    ‚îÇ updated_at      ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ closed_at       ‚îÇ           
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           
                              ‚îÇ                      
                              ‚îÇ                      
                              ‚ñº                      
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              
                    ‚îÇ    MESSAGES     ‚îÇ              
                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ              
                    ‚îÇ id (UUID) PK    ‚îÇ              
                    ‚îÇ ticket_id FK    ‚îÇ              
                    ‚îÇ user_id FK      ‚îÇ              
                    ‚îÇ content         ‚îÇ              
                    ‚îÇ attachments     ‚îÇ              
                    ‚îÇ is_internal     ‚îÇ              
                    ‚îÇ created_at      ‚îÇ              
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              
                            ‚îÇ                        
                            ‚îÇ                        
                            ‚ñº                        
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                
                  ‚îÇ NOTIFICATIONS   ‚îÇ                
                  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                
                  ‚îÇ id (UUID) PK    ‚îÇ                
                  ‚îÇ user_id FK      ‚îÇ                
                  ‚îÇ ticket_id FK    ‚îÇ                
                  ‚îÇ type            ‚îÇ                
                  ‚îÇ content         ‚îÇ                
                  ‚îÇ is_read         ‚îÇ                
                  ‚îÇ created_at      ‚îÇ                
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### üë• users - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Constraints |
|------|-----|----------|-------------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | PRIMARY KEY |
| `telegram_id` | BIGINT | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram | UNIQUE, NOT NULL |
| `username` | VARCHAR(255) | Username –≤ Telegram | NULLABLE |
| `first_name` | VARCHAR(255) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | NOT NULL |
| `last_name` | VARCHAR(255) | –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | NULLABLE |
| `role` | ENUM | –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | NOT NULL, DEFAULT 'USER' |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | NOT NULL, DEFAULT TRUE |
| `avatar_url` | TEXT | URL –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | NULLABLE |
| `language_code` | VARCHAR(10) | –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ | DEFAULT 'ru' |
| `is_premium` | BOOLEAN | Premium —Å—Ç–∞—Ç—É—Å –≤ Telegram | DEFAULT FALSE |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | NOT NULL, DEFAULT NOW() |

**Enum values –¥–ª—è role:**
- `USER` - –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `HELPER` - –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ–¥–¥–µ—Ä–∂–∫–∏  
- `MODERATOR` - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä
- `ADMIN` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- `DEVELOPER` - –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE UNIQUE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_active ON users(is_active);
```

### üé´ tickets - –¢–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Constraints |
|------|-----|----------|-------------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | PRIMARY KEY |
| `user_id` | UUID | ID –∞–≤—Ç–æ—Ä–∞ —Ç–∏–∫–µ—Ç–∞ | FK ‚Üí users.id, NOT NULL |
| `assigned_to` | UUID | ID –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ | FK ‚Üí users.id, NULLABLE |
| `category_id` | UUID | ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–∏–∫–µ—Ç–∞ | FK ‚Üí categories.id, NOT NULL |
| `title` | VARCHAR(500) | –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∏–∫–µ—Ç–∞ | NOT NULL |
| `description` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã | NOT NULL |
| `status` | ENUM | –°—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞ | NOT NULL, DEFAULT 'OPEN' |
| `priority` | ENUM | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–∏–∫–µ—Ç–∞ | NOT NULL, DEFAULT 'NORMAL' |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | NOT NULL, DEFAULT NOW() |
| `closed_at` | TIMESTAMP | –î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è | NULLABLE |

**Enum values –¥–ª—è status:**
- `OPEN` - –û—Ç–∫—Ä—ã—Ç (–Ω–æ–≤—ã–π —Ç–∏–∫–µ—Ç)
- `IN_PROGRESS` - –í —Ä–∞–±–æ—Ç–µ
- `WAITING_RESPONSE` - –û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
- `RESOLVED` - –†–µ—à–µ–Ω
- `CLOSED` - –ó–∞–∫—Ä—ã—Ç

**Enum values –¥–ª—è priority:**
- `LOW` - –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- `NORMAL` - –û–±—ã—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç  
- `HIGH` - –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- `CRITICAL` - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_tickets_user_id ON tickets(user_id);
CREATE INDEX idx_tickets_assigned_to ON tickets(assigned_to);
CREATE INDEX idx_tickets_category_id ON tickets(category_id);
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_priority ON tickets(priority);
CREATE INDEX idx_tickets_created_at ON tickets(created_at DESC);
CREATE INDEX idx_tickets_status_created ON tickets(status, created_at DESC);
```

### üí¨ messages - –°–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–∏–∫–µ—Ç–∞—Ö

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Constraints |
|------|-----|----------|-------------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | PRIMARY KEY |
| `ticket_id` | UUID | ID —Ç–∏–∫–µ—Ç–∞ | FK ‚Üí tickets.id, NOT NULL |
| `user_id` | UUID | ID –∞–≤—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è | FK ‚Üí users.id, NOT NULL |
| `content` | TEXT | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è | NOT NULL |
| `attachments` | JSONB | –ú–∞—Å—Å–∏–≤ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | DEFAULT '[]' |
| `is_internal` | BOOLEAN | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∑–∞–º–µ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ | DEFAULT FALSE |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ attachments JSON:**
```json
[
  {
    "id": "uuid",
    "filename": "screenshot.png",
    "size": 156789,
    "content_type": "image/png",
    "url": "/uploads/files/screenshot.png"
  }
]
```

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_messages_ticket_id ON messages(ticket_id);
CREATE INDEX idx_messages_user_id ON messages(user_id);
CREATE INDEX idx_messages_created_at ON messages(created_at DESC);
CREATE INDEX idx_messages_ticket_created ON messages(ticket_id, created_at DESC);
```

### üè∑Ô∏è categories - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Constraints |
|------|-----|----------|-------------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | PRIMARY KEY |
| `name` | VARCHAR(255) | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | NOT NULL |
| `description` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | NULLABLE |
| `icon` | VARCHAR(10) | –≠–º–æ–¥–∑–∏ –∏–∫–æ–Ω–∫–∞ | NOT NULL |
| `color` | VARCHAR(7) | HEX —Ü–≤–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | NOT NULL |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è | DEFAULT TRUE |
| `sort_order` | INTEGER | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ | DEFAULT 0 |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | NOT NULL, DEFAULT NOW() |

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_categories_active ON categories(is_active);
CREATE INDEX idx_categories_sort_order ON categories(sort_order);
```

### üîî notifications - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Constraints |
|------|-----|----------|-------------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | PRIMARY KEY |
| `user_id` | UUID | ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | FK ‚Üí users.id, NOT NULL |
| `ticket_id` | UUID | ID —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–∫–µ—Ç–∞ | FK ‚Üí tickets.id, NULLABLE |
| `type` | ENUM | –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | NOT NULL |
| `title` | VARCHAR(255) | –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | NOT NULL |
| `content` | TEXT | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | NOT NULL |
| `is_read` | BOOLEAN | –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ | DEFAULT FALSE |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |

**Enum values –¥–ª—è type:**
- `NEW_TICKET` - –ù–æ–≤—ã–π —Ç–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω
- `TICKET_ASSIGNED` - –¢–∏–∫–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω
- `TICKET_STATUS_CHANGED` - –°—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω
- `NEW_MESSAGE` - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–∏–∫–µ—Ç–µ
- `TICKET_CLOSED` - –¢–∏–∫–µ—Ç –∑–∞–∫—Ä—ã—Ç
- `SYSTEM` - –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_ticket_id ON notifications(ticket_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);
```

## üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### üìÅ files - –§–∞–π–ª–æ–≤—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Constraints |
|------|-----|----------|-------------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | PRIMARY KEY |
| `filename` | VARCHAR(255) | –ò–º—è —Ñ–∞–π–ª–∞ | NOT NULL |
| `original_filename` | VARCHAR(255) | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ | NOT NULL |
| `size` | BIGINT | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö | NOT NULL |
| `content_type` | VARCHAR(255) | MIME —Ç–∏–ø —Ñ–∞–π–ª–∞ | NOT NULL |
| `path` | TEXT | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É | NOT NULL |
| `url` | TEXT | URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É | NOT NULL |
| `uploaded_by` | UUID | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–≥—Ä—É–∑–∏–≤—à–µ–≥–æ —Ñ–∞–π–ª | FK ‚Üí users.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ | NOT NULL, DEFAULT NOW() |

## üîó –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏

```sql
-- –¢–∏–∫–µ—Ç—ã
ALTER TABLE tickets ADD CONSTRAINT fk_tickets_user_id 
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

ALTER TABLE tickets ADD CONSTRAINT fk_tickets_assigned_to 
    FOREIGN KEY (assigned_to) REFERENCES users(id) ON DELETE SET NULL;

ALTER TABLE tickets ADD CONSTRAINT fk_tickets_category_id 
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE RESTRICT;

-- –°–æ–æ–±—â–µ–Ω–∏—è
ALTER TABLE messages ADD CONSTRAINT fk_messages_ticket_id 
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE;

ALTER TABLE messages ADD CONSTRAINT fk_messages_user_id 
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
ALTER TABLE notifications ADD CONSTRAINT fk_notifications_user_id 
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

ALTER TABLE notifications ADD CONSTRAINT fk_notifications_ticket_id 
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE;

-- –§–∞–π–ª—ã
ALTER TABLE files ADD CONSTRAINT fk_files_uploaded_by 
    FOREIGN KEY (uploaded_by) REFERENCES users(id) ON DELETE SET NULL;
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
CREATE INDEX idx_tickets_user_status_created ON tickets(user_id, status, created_at DESC);

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
CREATE INDEX idx_tickets_assigned_status ON tickets(assigned_to, status) 
    WHERE status IN ('OPEN', 'IN_PROGRESS', 'WAITING_RESPONSE');

-- –ü–æ–∏—Å–∫ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Ç–µ–∫—Å—Ç—É (–¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–∏—Å–∫–æ–≤)
CREATE INDEX idx_tickets_title_gin ON tickets USING gin(to_tsvector('russian', title));
CREATE INDEX idx_tickets_description_gin ON tickets USING gin(to_tsvector('russian', description));

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
CREATE INDEX idx_tickets_category_status_created ON tickets(category_id, status, created_at);
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL

```sql
-- –£–≤–µ–ª–∏—á–∏—Ç—å shared_buffers –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
shared_buffers = 256MB

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON
shared_preload_libraries = 'pg_stat_statements'

-- –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–≤–∞–∫—É—É–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
autovacuum = on
autovacuum_max_workers = 3
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic
alembic init alembic

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "Initial database schema"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users)

```python
"""Initial database schema

Revision ID: 001_initial
Revises: 
Create Date: 2024-01-01 10:00:00.000000

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers
revision = '001_initial'
down_revision = None
branch_labels = None
depends_on = None

def upgrade():
    # –°–æ–∑–¥–∞–Ω–∏–µ ENUM —Ç–∏–ø–æ–≤
    role_enum = postgresql.ENUM('USER', 'HELPER', 'MODERATOR', 'ADMIN', 'DEVELOPER', name='user_role')
    role_enum.create(op.get_bind())
    
    status_enum = postgresql.ENUM('OPEN', 'IN_PROGRESS', 'WAITING_RESPONSE', 'RESOLVED', 'CLOSED', name='ticket_status')
    status_enum.create(op.get_bind())
    
    priority_enum = postgresql.ENUM('LOW', 'NORMAL', 'HIGH', 'CRITICAL', name='ticket_priority')
    priority_enum.create(op.get_bind())

    # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users
    op.create_table('users',
        sa.Column('id', sa.UUID(), nullable=False),
        sa.Column('telegram_id', sa.BigInteger(), nullable=False),
        sa.Column('username', sa.String(255), nullable=True),
        sa.Column('first_name', sa.String(255), nullable=False),
        sa.Column('last_name', sa.String(255), nullable=True),
        sa.Column('role', role_enum, nullable=False, server_default='USER'),
        sa.Column('is_active', sa.Boolean(), nullable=False, server_default='true'),
        sa.Column('avatar_url', sa.Text(), nullable=True),
        sa.Column('language_code', sa.String(10), nullable=False, server_default='ru'),
        sa.Column('is_premium', sa.Boolean(), nullable=False, server_default='false'),
        sa.Column('created_at', sa.TIMESTAMP(timezone=True), nullable=False, server_default=sa.func.now()),
        sa.Column('updated_at', sa.TIMESTAMP(timezone=True), nullable=False, server_default=sa.func.now()),
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('telegram_id')
    )
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
    op.create_index('idx_users_telegram_id', 'users', ['telegram_id'], unique=True)
    op.create_index('idx_users_role', 'users', ['role'])
    op.create_index('idx_users_active', 'users', ['is_active'])

def downgrade():
    # –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Ç–∏–ø–æ–≤
    op.drop_table('users')
    op.execute('DROP TYPE user_role')
    op.execute('DROP TYPE ticket_status') 
    op.execute('DROP TYPE ticket_priority')
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ UUID** –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **–í–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã messages –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã** –∏ –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **–î–µ–ª–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±–µ–∫–∞–ø—ã** –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º
```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
SELECT status, COUNT(*) as count 
FROM tickets 
GROUP BY status;

-- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
SELECT AVG(EXTRACT(EPOCH FROM (closed_at - created_at))/3600) as avg_hours
FROM tickets 
WHERE closed_at IS NOT NULL;
```

### –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
-- –¢–æ–ø-10 —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT u.first_name, u.username, COUNT(t.id) as tickets_count
FROM users u
LEFT JOIN tickets t ON u.id = t.user_id
GROUP BY u.id, u.first_name, u.username
ORDER BY tickets_count DESC
LIMIT 10;
```
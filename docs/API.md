# üì° API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API –¥–ª—è Telegram Ticket Bot —Å–∏—Å—Ç–µ–º—ã.

## üîó –ë–∞–∑–æ–≤—ã–π URL

```
https://api.yourbot.com/api/v1
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ API endpoints (–∫—Ä–æ–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```http
Authorization: Bearer <jwt_token>
```

---

## üîë –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### POST /auth/telegram
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Telegram WebApp.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "initData": "string",  // Telegram WebApp initData
  "hash": "string"       // HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer",
  "expires_in": 604800,
  "user": {
    "id": "uuid",
    "telegram_id": 123456789,
    "username": "john_doe",
    "first_name": "John",
    "role": "USER",
    "created_at": "2024-01-01T10:00:00Z"
  }
}
```

### GET /auth/me
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "uuid",
  "telegram_id": 123456789,
  "username": "john_doe",
  "first_name": "John",
  "last_name": "Doe",
  "role": "USER",
  "is_active": true,
  "created_at": "2024-01-01T10:00:00Z",
  "updated_at": "2024-01-01T12:00:00Z"
}
```

### PUT /auth/profile
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "first_name": "John",
  "last_name": "Doe",
  "username": "john_doe"
}
```

---

## üé´ –¢–∏–∫–µ—Ç—ã

### GET /tickets
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `status` - –°—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞ (OPEN, IN_PROGRESS, WAITING_RESPONSE, RESOLVED, CLOSED)
- `category_id` - ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `priority` - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (LOW, NORMAL, HIGH, CRITICAL)
- `assigned_to` - ID –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `page` - –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `size` - –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)

**–û—Ç–≤–µ—Ç:**
```json
{
  "items": [
    {
      "id": "uuid",
      "title": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π",
      "description": "–ù–µ –º–æ–≥—É –æ–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É",
      "status": "OPEN",
      "priority": "HIGH",
      "category": {
        "id": "uuid",
        "name": "–û–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∞",
        "icon": "üí≥"
      },
      "user": {
        "id": "uuid",
        "first_name": "John",
        "username": "john_doe"
      },
      "assigned_to": null,
      "created_at": "2024-01-01T10:00:00Z",
      "updated_at": "2024-01-01T10:00:00Z",
      "messages_count": 3,
      "last_message_at": "2024-01-01T11:00:00Z"
    }
  ],
  "total": 50,
  "page": 1,
  "size": 20,
  "pages": 3
}
```

### POST /tickets
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–∫–µ—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "title": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π",
  "description": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã...",
  "category_id": "uuid",
  "priority": "HIGH"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "uuid",
  "title": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π",
  "description": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã...",
  "status": "OPEN",
  "priority": "HIGH",
  "category_id": "uuid",
  "user_id": "uuid",
  "created_at": "2024-01-01T10:00:00Z"
}
```

### GET /tickets/{id}
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏–∫–µ—Ç–µ.

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "uuid",
  "title": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π",
  "description": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã...",
  "status": "OPEN",
  "priority": "HIGH",
  "category": {
    "id": "uuid",
    "name": "–û–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∞",
    "icon": "üí≥",
    "color": "#ff6b6b"
  },
  "user": {
    "id": "uuid",
    "telegram_id": 123456789,
    "first_name": "John",
    "username": "john_doe"
  },
  "assigned_to": {
    "id": "uuid",
    "first_name": "Support",
    "role": "HELPER"
  },
  "created_at": "2024-01-01T10:00:00Z",
  "updated_at": "2024-01-01T12:00:00Z",
  "closed_at": null
}
```

### PUT /tickets/{id}
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "title": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫",
  "status": "IN_PROGRESS",
  "priority": "NORMAL",
  "assigned_to": "uuid"
}
```

### DELETE /tickets/{id}
–£–¥–∞–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–¢–∏–∫–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
}
```

---

## üí¨ –°–æ–æ–±—â–µ–Ω–∏—è

### GET /tickets/{ticket_id}/messages
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–∏–∫–µ—Ç–∞.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` - –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `size` - –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)

**–û—Ç–≤–µ—Ç:**
```json
{
  "items": [
    {
      "id": "uuid",
      "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –£ –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π...",
      "user": {
        "id": "uuid",
        "first_name": "John",
        "role": "USER"
      },
      "attachments": [
        {
          "id": "uuid",
          "filename": "screenshot.png",
          "size": 156789,
          "content_type": "image/png",
          "url": "/uploads/files/screenshot.png"
        }
      ],
      "is_internal": false,
      "created_at": "2024-01-01T10:00:00Z"
    }
  ],
  "total": 5,
  "page": 1,
  "size": 50
}
```

### POST /tickets/{ticket_id}/messages
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–∏–∫–µ—Ç.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "is_internal": false,  // true –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∑–∞–º–µ—Ç–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
  "attachments": ["file_uuid_1", "file_uuid_2"]
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "uuid",
  "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "user_id": "uuid",
  "ticket_id": "uuid",
  "is_internal": false,
  "created_at": "2024-01-01T10:30:00Z"
}
```

---

## üìÅ –§–∞–π–ª—ã

### POST /files/upload
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** multipart/form-data
- `file` - –§–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "uuid",
  "filename": "document.pdf",
  "size": 1024567,
  "content_type": "application/pdf",
  "url": "/uploads/files/document.pdf",
  "created_at": "2024-01-01T10:00:00Z"
}
```

### GET /files/{id}
–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞.

**–û—Ç–≤–µ—Ç:** –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞

---

## üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

### GET /categories
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–∏–∫–µ—Ç–æ–≤.

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": "uuid",
    "name": "–û–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∞",
    "description": "–í–æ–ø—Ä–æ—Å—ã –ø–æ –æ–ø–ª–∞—Ç–µ, –≤–æ–∑–≤—Ä–∞—Ç—É —Å—Ä–µ–¥—Å—Ç–≤, –ø—Ä–æ–¥–ª–µ–Ω–∏—é –ø–æ–¥–ø–∏—Å–∫–∏",
    "icon": "üí≥",
    "color": "#ff6b6b",
    "is_active": true,
    "sort_order": 1
  },
  {
    "id": "uuid",
    "name": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã",
    "description": "–û—à–∏–±–∫–∏, –∫—Ä–∞—à–∏, –ø—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π",
    "icon": "üîß",
    "color": "#4ecdc4",
    "is_active": true,
    "sort_order": 2
  }
]
```

### POST /categories
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "name": "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
  "icon": "üÜï",
  "color": "#45b7d1",
  "sort_order": 10
}
```

### PUT /categories/{id}
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

### DELETE /categories/{id}
–£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

---

## üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### GET /users
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤+).

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `role` - –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏
- `is_active` - –§–∏–ª—å—Ç—Ä –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `search` - –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/username
- `page`, `size` - –ü–∞–≥–∏–Ω–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "items": [
    {
      "id": "uuid",
      "telegram_id": 123456789,
      "username": "john_doe",
      "first_name": "John",
      "role": "USER",
      "is_active": true,
      "created_at": "2024-01-01T10:00:00Z",
      "tickets_count": 5,
      "last_activity": "2024-01-01T15:00:00Z"
    }
  ],
  "total": 100,
  "page": 1,
  "size": 20
}
```

### PUT /users/{id}/role
–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "role": "HELPER"
}
```

### PUT /users/{id}/status
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "is_active": false
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### GET /statistics/dashboard
–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞.

**–û—Ç–≤–µ—Ç:**
```json
{
  "tickets": {
    "total": 150,
    "open": 25,
    "in_progress": 15,
    "resolved": 8,
    "closed": 102
  },
  "response_time": {
    "average_hours": 4.5,
    "median_hours": 2.1
  },
  "categories": [
    {
      "name": "–û–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∞",
      "count": 45,
      "percentage": 30
    }
  ],
  "helpers": [
    {
      "user": {
        "first_name": "Support Agent",
        "role": "HELPER"
      },
      "tickets_handled": 25,
      "avg_response_time": 3.2
    }
  ]
}
```

### GET /statistics/tickets
–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `from_date` - –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞
- `to_date` - –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞
- `category_id` - –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

---

## ‚ùå –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 400 | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| 401 | –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω |
| 403 | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω |
| 404 | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| 422 | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö |
| 429 | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
| 500 | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

**–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:**
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
    "details": [
      {
        "field": "title",
        "message": "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"
      }
    ]
  }
}
```

---

## üîå WebSocket API

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/tickets/{ticket_id}?token={jwt_token}');
```

### –°–æ–±—ã—Ç–∏—è

**–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```json
{
  "type": "new_message",
  "data": {
    "id": "uuid",
    "content": "–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "user": {...},
    "created_at": "2024-01-01T10:30:00Z"
  }
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:**
```json
{
  "type": "status_changed",
  "data": {
    "ticket_id": "uuid",
    "old_status": "OPEN",
    "new_status": "IN_PROGRESS",
    "changed_by": {...}
  }
}
```

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç:**
```json
{
  "type": "typing",
  "data": {
    "user_id": "uuid",
    "is_typing": true
  }
}
```